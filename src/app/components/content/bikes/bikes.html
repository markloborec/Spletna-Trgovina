<div class="bikes-page" aria-labelledby="bikes-title">
    <div class="bikes-header">
        <h1 id="bikes-title">Kolesa</h1>
    </div>

    <div class="bikes-filters" role="region" aria-label="Filtri in razvr≈°ƒçanje">
        <div class="filter-group">
            <label for="wheelSize">Velikost obroƒçev</label>
            <select id="wheelSize" name="wheelSize" [(ngModel)]="filter.wheelSize">
                <option [ngValue]="''">Vse</option>
                <option [ngValue]="26">26"</option>
                <option [ngValue]="27.5">27.5"</option>
                <option [ngValue]="28">28"</option>
                <option [ngValue]="29">29"</option>
            </select>
        </div>

        <div class="filter-group">
            <label for="frameMaterial">Okvir</label>
            <input id="frameMaterial" name="frameMaterial" type="text" [(ngModel)]="filter.frameMaterial"
                placeholder="Npr. Aluminij" autocomplete="off" />
        </div>

        <div class="filter-group">
            <label for="minGears">Min. prestav</label>
            <input id="minGears" name="minGears" type="number" min="1" [(ngModel)]="filter.minGears"
                placeholder="Npr. 10" inputmode="numeric" />
        </div>

        <div class="filter-group">
            <label for="availability">Razpolo≈æljivost</label>
            <select id="availability" name="availability" [(ngModel)]="filter.availability">
                <option value="">Vse</option>
                <option value="available">Na zalogi</option>
                <option value="unavailable">Ni na zalogi</option>
            </select>
        </div>

        <div class="filter-group">
            <label for="sortBy">Sortiraj</label>
            <select id="sortBy" name="sortBy" [(ngModel)]="sortBy">
                <option value="name">Ime</option>
                <option value="price">Cena</option>
                <option value="wheelSize">Velikost obroƒçev</option>
                <option value="gearCount">≈†t. prestav</option>
            </select>
        </div>

        <div class="filter-group filter-group-button">
            <span class="sr-only" id="sortDirectionHelp">Spremeni smer razvr≈°ƒçanja</span>
            <button class="sort-dir" type="button" (click)="toggleSortDirection()"
                [attr.aria-pressed]="sortDirection === 'desc'" aria-describedby="sortDirectionHelp">
                {{ sortDirection === 'asc' ? '‚¨Ü Nara≈°ƒçajoƒçe' : '‚¨á Padajoƒçe' }}
            </button>
        </div>
    </div>

    <div class="bikes-grid" role="list" aria-label="Seznam koles">
        <div class="bike-card" role="listitem" *ngFor="let bike of filteredAndSortedBicycles; trackBy: trackByBikeId">
            <!-- Klik na kartico (dostopno s tipkovnico) -->
            <div class="bike-card-click" role="button" tabindex="0"
                [attr.aria-label]="'Odpri podrobnosti: ' + (bike.name || 'kolo')"
                (click)="openDetailsFromCard(bike, $event)" (keydown)="onCardKeydown($event, bike)">
                <div class="bike-image-wrapper">
                    <img *ngIf="bike.imageUrl" [src]="bike.imageUrl" [alt]="getBikeImageAlt(bike)" class="bike-image"
                        loading="lazy" (error)="onImageError(bike)" />

                    <div class="bike-image-placeholder" *ngIf="!bike.imageUrl" aria-hidden="true">
                        <span class="placeholder-icon">üö≤</span>
                        <span class="placeholder-name">{{ bike.name }}</span>
                    </div>

                    <span class="badge badge-unavailable" *ngIf="!bike.isAvailable" aria-label="Ni na zalogi">Ni na
                        zalogi</span>
                </div>

                <div class="bike-info">
                    <div class="bike-name">{{ bike.name }}</div>

                    <div class="bike-description">
                        {{ bike.shortDescription }}
                    </div>

                    <div class="bike-specs" aria-label="Specifikacije">
                        <div class="spec">
                            <span class="label">Velikost obroƒçev</span>
                            <span class="value">{{ bike.wheelSize }}"</span>
                        </div>
                        <div class="spec">
                            <span class="label">Okvir</span>
                            <span class="value">{{ bike.frameMaterial }}</span>
                        </div>
                        <div class="spec">
                            <span class="label">Prestav</span>
                            <span class="value">{{ bike.gearCount }}</span>
                        </div>
                        <div class="spec">
                            <span class="label">Garancija</span>
                            <span class="value">{{ bike.warrantyMonths }} mesecev</span>
                        </div>
                    </div>

                    <div class="bike-bottom">
                        <div class="bike-price"
                            [attr.aria-label]="'Cena: ' + (bike.price | currency : 'EUR' : 'symbol' : '1.2-2' : 'sl-SI')">
                            {{ bike.price | currency : 'EUR' : 'symbol' : '1.2-2' : 'sl-SI' }}
                        </div>

                        <!-- Akcije (ne klikajo kartice) -->
                        <div class="actions" (click)="$event.stopPropagation()">
                            <button class="add-to-cart" type="button" [disabled]="!bike.isAvailable"
                                [attr.aria-disabled]="!bike.isAvailable"
                                [attr.aria-label]="bike.isAvailable ? ('Dodaj v ko≈°arico: ' + bike.name) : ('Ni na zalogi: ' + bike.name)"
                                (click)="addToCart(bike)">
                                {{ bike.isAvailable ? 'Dodaj v ko≈°arico' : 'Obvesti me' }}
                            </button>

                            <a *ngIf="bike.officialProductSite" class="official-link" [href]="bike.officialProductSite"
                                target="_blank" rel="noopener noreferrer"
                                [attr.aria-label]="'Odpri uradno stran za ' + (bike.name || 'produkt') + ' (odpre se v novem zavihku)'">
                                Uradna stran
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<app-product-info *ngIf="selectedBike" [product]="selectedBike" (close)="closeDetails()" />