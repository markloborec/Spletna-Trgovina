<div class="login-backdrop" (click)="onBackdropClick($event)" (keydown)="onKeydown($event)" tabindex="-1">
    <div class="login-dialog" role="dialog" aria-modal="true" [attr.aria-labelledby]="titleId"
        [attr.aria-describedby]="descId" (click)="$event.stopPropagation()">
        <p class="sr-only" [id]="descId">
            Prijavno okno. Za zapiranje pritisni Escape. Premikaš se lahko s tipko Tab.
        </p>

        <h2 [id]="titleId" tabindex="-1" #dialogTitle>
            <ng-container [ngSwitch]="view">
                <span *ngSwitchCase="'login'">Prijava</span>
                <span *ngSwitchCase="'forgot'">Pozabljeno geslo</span>
                <span *ngSwitchCase="'reset'">Ponastavitev gesla</span>
            </ng-container>
        </h2>

        <p class="subtitle" *ngIf="view === 'login'">
            Prijavi se v svoj BiciklStore račun.
        </p>
        <p class="subtitle" *ngIf="view === 'forgot'">
            Vpiši e-pošto in poslali ti bomo navodila za ponastavitev.
        </p>
        <p class="subtitle" *ngIf="view === 'reset'">
            Vpiši novo geslo.
        </p>

        <!-- LOGIN VIEW -->
        <form *ngIf="view === 'login'" (ngSubmit)="onSubmit()" #loginForm="ngForm" novalidate>
            <div class="field">
                <label for="email">E-pošta *</label>
                <input id="email" name="email" type="email" required [(ngModel)]="formData.email" autocomplete="email"
                    #firstField />
            </div>

            <div class="field">
                <label for="password">Geslo *</label>
                <input id="password" name="password" type="password" required [(ngModel)]="formData.password"
                    autocomplete="current-password" />
            </div>

            <button type="button" class="forgot-password" (click)="onForgotPassword()" aria-label="Pozabljeno geslo">
                Pozabljeno geslo?
            </button>

            <div class="actions">
                <button type="button" class="btn ghost" (click)="onCancel()" aria-label="Prekliči">
                    Prekliči
                </button>
                <button type="submit" class="btn primary" [disabled]="isSubmitting"
                    [attr.aria-disabled]="isSubmitting ? 'true' : null" aria-label="Prijavi se">
                    {{ isSubmitting ? 'Prijava...' : 'Vpiši se' }}
                </button>
            </div>
        </form>

        <!-- FORGOT PASSWORD VIEW -->
        <form *ngIf="view === 'forgot'" (ngSubmit)="submitForgotPassword()" #forgotForm="ngForm" novalidate>
            <div class="field">
                <label for="forgotEmail">E-pošta *</label>
                <input id="forgotEmail" name="forgotEmail" type="email" required [(ngModel)]="forgotData.email"
                    autocomplete="email" #firstField />
            </div>

            <div class="actions">
                <button type="button" class="btn ghost" (click)="onCancel()" aria-label="Nazaj">
                    Nazaj
                </button>
                <button type="submit" class="btn primary" [disabled]="isSubmitting"
                    [attr.aria-disabled]="isSubmitting ? 'true' : null" aria-label="Pošlji navodila za ponastavitev">
                    {{ isSubmitting ? 'Pošiljanje...' : 'Pošlji navodila' }}
                </button>
            </div>
        </form>

        <!-- RESET PASSWORD VIEW -->
        <form *ngIf="view === 'reset'" (ngSubmit)="submitResetPassword()" #resetForm="ngForm" novalidate>
            <div class="field">
                <label for="token">Token *</label>
                <input id="token" name="token" type="text" required [(ngModel)]="resetData.token" autocomplete="off"
                    #firstField />
                <p class="help" id="tokenHelp">
                    Če bi bila to produkcijska aplikacija, bi token dobil po e-pošti. Tukaj je zaradi šolskega projekta.
                </p>
            </div>

            <div class="field">
                <label for="newPassword">Novo geslo *</label>
                <input id="newPassword" name="newPassword" type="password" required [(ngModel)]="resetData.newPassword"
                    autocomplete="new-password" />
            </div>

            <div class="field">
                <label for="confirmPassword">Ponovi geslo *</label>
                <input id="confirmPassword" name="confirmPassword" type="password" required
                    [(ngModel)]="resetData.confirmPassword" autocomplete="new-password" />
            </div>

            <div class="actions">
                <button type="button" class="btn ghost" (click)="onCancel()" aria-label="Nazaj">
                    Nazaj
                </button>
                <button type="submit" class="btn primary" [disabled]="isSubmitting"
                    [attr.aria-disabled]="isSubmitting ? 'true' : null" aria-label="Shrani novo geslo">
                    {{ isSubmitting ? 'Shranjujem...' : 'Shrani novo geslo' }}
                </button>
            </div>
        </form>

        <p class="success" *ngIf="successMessage" role="status" aria-live="polite">
            {{ successMessage }}
        </p>
        <p class="error" *ngIf="errorMessage" role="alert">
            {{ errorMessage }}
        </p>
    </div>
</div>